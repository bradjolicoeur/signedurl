# Summary
This is an example showing how to generate a signed URL for AWS S3.  This example used Localstack and is for demo purposes only.

Running `docker-compose up` in the root folder of the repo will launch localstack.  You will need localstack running before you can run the project.


# Running the Example

1. Use `docker-compose up` in the root of the project file to start localstack
2. Launch the project, Default page will be Swagger UI, 
3. Use Swagger UI to first execute `/api/signedurl/createfile` to set a file in S3
4. Then excute `/api/SignedUrl/geturl` to get the signed URL for the file


The `GetPresignedUrl.cs` file has the magic for generating presigned URL.  

This block of code uses the `IAmazonS3` client and takes in the bucket name, file name and the expiration time 

```csharp
var result = _client.GetPreSignedURL(new GetPreSignedUrlRequest
            {
                BucketName = _settings.Bucket,
                Key = Filename,
                Expires = DateTime.Now.AddMinutes(1),
                Protocol = Protocol.HTTP
            });
```

Note that the protocol is set to HTTP only to make the interaction with localstack easier. `Protocol.HTTP` should not be used for production code.

An example of a Presigned URL generated by this demo: `http://localhost:4572/mybucket/uploadme.txt?AWSAccessKeyId=123&Expires=1581526401&Signature=WmlKSR2Yc%2B0NuZGMQlbR2lx9iUs%3D`

# Resources
- [https://ignas.me/tech/localstack-s3-setup-net-core-development/]
- [https://serverless.com/blog/s3-one-time-signed-url/]